var Fe=Object.create;var W=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,qe=Object.prototype.hasOwnProperty;var ce=n=>W(n,"__esModule",{value:!0});var Be=(n,e)=>()=>(n&&(e=n(n=0)),e);var ze=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Q=(n,e)=>{ce(n);for(var t in e)W(n,t,{get:e[t],enumerable:!0})},Ae=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Te(e))!qe.call(n,r)&&r!=="default"&&W(n,r,{get:()=>e[r],enumerable:!(t=Me(e,r))||t.enumerable});return n},ee=n=>Ae(ce(W(n!=null?Fe(Ne(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var pe={};Q(pe,{proxyClasses:()=>Ie});function Ie(n,e,t){let r={};for(let s of e){let o=s.name,a=function(...l){if(!t())throw Error(Pe(o));let p=n();return new p[o](...l)};for(let l of s.props){let p=l.name;l.type==="function"?a[p]=function(...f){if(!t())throw Error(Oe(o,p));return n()[o][p].apply(this,f)}:Object.defineProperty(a,p,{get:function(){return n()[o][p]}})}r[o]=a}return r}var Pe,Oe,de=Be(()=>{Pe=n=>`Cannot call class constructor because snarkyjs has not finished loading.
Try calling \`await isReady\` before \`new ${n}()\``,Oe=(n,e)=>`Cannot call static method because snarkyjs has not finished loading.
Try calling \`await isReady\` before \`${n}.${e}()\``});var he=ze((pt,He)=>{He.exports=[{name:"Field",props:[{name:"one",type:"object"},{name:"zero",type:"object"},{name:"random",type:"function"},{name:"add",type:"function"},{name:"sub",type:"function"},{name:"mul",type:"function"},{name:"div",type:"function"},{name:"neg",type:"function"},{name:"inv",type:"function"},{name:"square",type:"function"},{name:"sqrt",type:"function"},{name:"toString",type:"function"},{name:"sizeInFields",type:"function"},{name:"toFields",type:"function"},{name:"ofFields",type:"function"},{name:"assertEqual",type:"function"},{name:"assertBoolean",type:"function"},{name:"isZero",type:"function"},{name:"ofBits",type:"function"},{name:"toBits",type:"function"},{name:"equal",type:"function"},{name:"toJSON",type:"function"},{name:"fromJSON",type:"function"}]},{name:"Bool",props:[{name:"toField",type:"function"},{name:"Unsafe",type:"object"},{name:"not",type:"function"},{name:"and",type:"function"},{name:"or",type:"function"},{name:"assertEqual",type:"function"},{name:"equal",type:"function"},{name:"isTrue",type:"function"},{name:"isFalse",type:"function"},{name:"count",type:"function"},{name:"sizeInFields",type:"function"},{name:"toFields",type:"function"},{name:"ofFields",type:"function"},{name:"check",type:"function"},{name:"toJSON",type:"function"},{name:"fromJSON",type:"function"}]},{name:"Circuit",props:[{name:"runAndCheck",type:"function"},{name:"asProver",type:"function"},{name:"witness",type:"function"},{name:"array",type:"function"},{name:"generateKeypair",type:"function"},{name:"prove",type:"function"},{name:"verify",type:"function"},{name:"assertEqual",type:"function"},{name:"equal",type:"function"},{name:"toFields",type:"function"},{name:"inProver",type:"function"},{name:"inCheckedComputation",type:"function"},{name:"if",type:"function"}]},{name:"Poseidon",props:[{name:"hash",type:"function"}]},{name:"Group",props:[{name:"generator",type:"object"},{name:"add",type:"function"},{name:"sub",type:"function"},{name:"neg",type:"function"},{name:"scale",type:"function"},{name:"assertEqual",type:"function"},{name:"equal",type:"function"},{name:"toFields",type:"function"},{name:"ofFields",type:"function"},{name:"sizeInFields",type:"function"},{name:"check",type:"function"},{name:"toJSON",type:"function"},{name:"fromJSON",type:"function"}]},{name:"Scalar",props:[{name:"toFields",type:"function"},{name:"sizeInFields",type:"function"},{name:"ofFields",type:"function"},{name:"random",type:"function"},{name:"ofBits",type:"function"},{name:"toJSON",type:"function"},{name:"fromJSON",type:"function"}]},{name:"Ledger",props:[{name:"create",type:"function"}]}]});Q(exports,{AccountPredicate:()=>K,Amount:()=>Re,Balance:()=>Ue,Body:()=>M,Bool:()=>h,Circuit:()=>y,CircuitValue:()=>x,ClosedInterval:()=>Y,EpochDataPredicate:()=>ie,EpochLedgerPredicate:()=>oe,Fee:()=>We,Field:()=>i,GlobalSlot:()=>Ye,Group:()=>C,Int64:()=>S,Ledger:()=>te,Mina:()=>le,Optional:()=>ke,OrIgnore:()=>se,Party:()=>A,PartyBalance:()=>ae,Perm:()=>g,Permissions:()=>j,Poseidon:()=>P,PrivateKey:()=>B,ProofWithInput:()=>_e,ProtocolStatePredicate:()=>H,PublicKey:()=>N,Scalar:()=>T,SetOrKeep:()=>ne,Signature:()=>O,SignedAmount:()=>Ze,SmartContract:()=>ue,State:()=>st,Timing:()=>Se,UInt32:()=>c,UInt64:()=>d,Update:()=>re,arrayProp:()=>je,asFieldElementsToConstant:()=>De,branch:()=>ut,circuitMain:()=>Xe,getDefaultTokenId:()=>be,isReady:()=>Je,matrixProp:()=>Ge,method:()=>at,proofSystem:()=>lt,prop:()=>_,public_:()=>$e,shutdown:()=>Ve,state:()=>it});var{proxyClasses:Le}=(de(),pe),fe=require("./node_bindings/snarky_js_node.bc.js"),Ke=he(),{Field:i,Bool:h,Circuit:y,Poseidon:P,Group:C,Scalar:T,Ledger:te}=Le(()=>fe,Ke,()=>ye),ye=!1,Je=fe.snarky_ready.then(()=>{ye=!0}),me=!1;function Ve(){if(global.wasm_rayon_poolbuilder&&!me)return me=!0,global.wasm_rayon_poolbuilder.free(),Promise.all(global.wasm_workers.map(async n=>{await n.terminate()}))}var E=ee(require("tslib"));var ht=ee(require("reflect-metadata"));function De(n,e){let t=n.toFields(e);return n.ofFields(t)}var x=class{static sizeInFields(){return this.prototype._fields.reduce((t,[r,s])=>t+s.sizeInFields(),0)}static toFields(e){let t=[],r=this.prototype._fields;if(r==null)return t;for(let s=0,o=r.length;s<o;++s){let[a,l]=r[s];l.toFields(e[a]).forEach(f=>t.push(f))}return t}toFields(){return this.constructor.toFields(this)}toJSON(){return this.constructor.toJSON(this)}equals(e){return y.equal(this,e)}assertEquals(e){y.assertEqual(this,e)}static ofFields(e){let t=this.prototype._fields,r=0,s=[];for(let o=0;o<t.length;++o){let a=t[o][1],l=a.sizeInFields(),p=a.ofFields(e.slice(r,r+l));s.push(p),r+=l}return new this(...s)}static toConstant(e){let t=this.toFields(e);return this.ofFields(t.map(r=>r.toConstant()))}static toJSON(e){let t={};return this.prototype._fields!==void 0&&this.prototype._fields.forEach(([s,o])=>{t[s]=o.toJSON(e[s])}),t}static fromJSON(e){let t=[],r=this.prototype._fields;switch(typeof e){case"object":if(e===null||Array.isArray(e))return null;break;default:return null}if(r!==void 0)for(let s=0;s<r.length;++s){let[o,a]=r[s];if(e[o]===void 0)return null;t.push(a.fromJSON(e[o]))}return new this(...t)}};x.check=function(n){let e=this.prototype._fields;if(e!=null)for(let t=0;t<e.length;++t){let[r,s]=e[t],o=n[r];s.check!=null&&s.check(o)}};function _(n,e){let t=Reflect.getMetadata("design:type",n,e);(n._fields===void 0||n._fields===null)&&(n._fields=[]),t===void 0||(t.toFields&&t.ofFields?n._fields.push([e,t]):console.log(`warning: property ${e} missing field element conversion methods`))}function je(n,e){return function(t,r){(t._fields===void 0||t._fields===null)&&(t._fields=[]),t._fields.push([r,y.array(n,e)])}}function Ge(n,e,t){return function(r,s){r._fields??(r._fields=[]),r._fields.push([s,y.array(y.array(n,t),e)])}}function $e(n,e,t){n._public===void 0&&(n._public=[]),n._public.push(t)}function ge(n){return{sizeInFields:()=>n.reduce((e,t)=>e+t.sizeInFields(),0),toFields:e=>{if(e.length!==n.length)throw new Error(`typOfArray: Expected ${n.length}, got ${e.length}`);let t=[];for(let r=0;r<e.length;++r)t.push(...n[r].toFields(e[r]));return t},ofFields:e=>{let t=0,r=[];return n.forEach(s=>{let o=s.sizeInFields();r.push(s.ofFields(e.slice(t,t+o))),t+=o}),r}}}function Xe(n,e,t){let r=Reflect.getMetadata("design:paramtypes",n,e),s=r.length,o=new Set(n._public),a=new Set;for(let l=0;l<s;++l)o.has(l)||a.add(l);n.snarkyMain=(l,p)=>{let f=[];for(let u=0;u<s;++u)f.push((o.has(u)?p:l).shift());return n[e].apply(n,f)},n.snarkyWitnessTyp=ge(Array.from(a).map(l=>r[l])),n.snarkyPublicTyp=ge(Array.from(o).map(l=>r[l]))}var B=class extends x{constructor(e){super();this.s=e}static random(){return new B(T.random())}static ofBits(e){return new B(T.ofBits(e))}toPublicKey(){return new N(C.generator.scale(this.s))}};(0,E.__decorate)([_,(0,E.__metadata)("design:type",T)],B.prototype,"s",void 0);var N=class extends x{constructor(e){super();this.g=e}static fromPrivateKey(e){return e.toPublicKey()}};(0,E.__decorate)([_,(0,E.__metadata)("design:type",C)],N.prototype,"g",void 0);var O=class extends x{constructor(e,t){super();this.r=e,this.s=t}static create(e,t){let{g:r}=N.fromPrivateKey(e),s=e.s,o=T.random(),{x:a,y:l}=C.generator.scale(o),p=l.toBits()[0].toBoolean()?o.neg():o,u=T.ofBits(P.hash(t.concat([r.x,r.y,a])).toBits()).mul(s).add(p);return new O(a,u)}verify(e,t){let r=e.g,s=T.ofBits(P.hash(t.concat([r.x,r.y,this.r])).toBits()),o=r.scale(s).neg().add(C.generator.scale(this.s));return h.and(o.x.equals(this.r),o.y.toBits()[0].equals(!1))}};(0,E.__decorate)([_,(0,E.__metadata)("design:type",i)],O.prototype,"r",void 0);(0,E.__decorate)([_,(0,E.__metadata)("design:type",T)],O.prototype,"s",void 0);var F=ee(require("tslib"));function b(n,e){if(typeof e=="number"){if(!Number.isInteger(e))throw new Error(`${n} expected integer argument. Got ${e}`);return new i(e)}else return e.value}var d=class extends x{constructor(e){super();this.value=e}static get zero(){return new d(i.zero)}toString(){return this.value.toString()}static check(e){e.value.rangeCheckHelper(64).assertEquals(e.value)}static MAXINT(){return new d(i.fromJSON(((1n<<64n)-1n).toString()))}static fromNumber(e){return new d(b("UInt64.fromNumber",e))}divMod(e){let t=this.value,r=b("UInt64.div",e);if(this.value.isConstant()&&r.isConstant()){let p=BigInt(t.toString()),f=BigInt(r.toString()),u=p/f,w=p-u*f;return[new d(new i(u.toString())),new d(new i(w.toString()))]}r=r.seal();let s=y.witness(i,()=>new i((BigInt(t.toString())/BigInt(r.toString())).toString()));s.rangeCheckHelper(d.NUM_BITS).assertEquals(s);let o=t.sub(s.mul(r)).seal();o.rangeCheckHelper(d.NUM_BITS).assertEquals(o);let a=new d(o),l=new d(s);return a.assertLt(new d(r)),[l,a]}div(e){return this.divMod(e)[0]}mod(e){return this.divMod(e)[1]}mul(e){let t=this.value.mul(b("UInt64.mul",e));return t.rangeCheckHelper(d.NUM_BITS).assertEquals(t),new d(t)}add(e){let t=this.value.add(b("UInt64.add",e));return t.rangeCheckHelper(d.NUM_BITS).assertEquals(t),new d(t)}sub(e){let t=this.value.sub(b("UInt64.sub",e));return t.rangeCheckHelper(d.NUM_BITS).assertEquals(t),new d(t)}lte(e){let t=this.value.sub(b("UInt64.lte",e)).seal(),r=t.rangeCheckHelper(d.NUM_BITS).equals(t),s=t.rangeCheckHelper(d.NUM_BITS).equals(t.neg());return r.or(s).assertEquals(!0),s}assertLte(e){let t=b("UInt64.lt",e).sub(this.value).seal();t.rangeCheckHelper(d.NUM_BITS).assertEquals(t)}lt(e){return this.lte(e).and(this.value.equals(e.value).not())}assertLt(e){this.lt(e).assertEquals(!0)}gt(e){return e.lt(this)}assertGt(e){e.assertLt(this)}};d.NUM_BITS=64;(0,F.__decorate)([_,(0,F.__metadata)("design:type",i)],d.prototype,"value",void 0);var c=class extends x{constructor(e){super();this.value=e}static get zero(){return new c(i.zero)}toString(){return this.value.toString()}static check(e){e.value.rangeCheckHelper(32).assertEquals(e.value)}static fromNumber(e){return new c(b("UInt32.fromNumber",e))}static MAXINT(){return new c(i.fromJSON(((1n<<32n)-1n).toString()))}divMod(e){let t=this.value,r=b("UInt32.div",e);if(this.value.isConstant()&&r.isConstant()){let p=BigInt(t.toString()),f=BigInt(r.toString()),u=p/f,w=p-u*f;return[new c(new i(u.toString())),new c(new i(w.toString()))]}r=r.seal();let s=y.witness(i,()=>new i((BigInt(t.toString())/BigInt(r.toString())).toString()));s.rangeCheckHelper(c.NUM_BITS).assertEquals(s);let o=t.sub(s.mul(r)).seal();o.rangeCheckHelper(c.NUM_BITS).assertEquals(o);let a=new c(o),l=new c(s);return a.assertLt(new c(r)),[l,a]}div(e){return this.divMod(e)[0]}mod(e){return this.divMod(e)[1]}mul(e){let t=this.value.mul(b("UInt32.mul",e));return t.rangeCheckHelper(c.NUM_BITS).assertEquals(t),new c(t)}add(e){let t=this.value.add(b("UInt32.add",e));return t.rangeCheckHelper(c.NUM_BITS).assertEquals(t),new c(t)}sub(e){let t=this.value.sub(b("UInt32.sub",e));return t.rangeCheckHelper(c.NUM_BITS).assertEquals(t),new c(t)}lte(e){let t=this.value.sub(b("UInt32.lte",e)).seal(),r=t.rangeCheckHelper(c.NUM_BITS).equals(t),s=t.rangeCheckHelper(c.NUM_BITS).equals(t.neg());return r.or(s).assertEquals(!0),s}assertLte(e){let t=b("UInt32.lt",e).sub(this.value).seal();t.rangeCheckHelper(c.NUM_BITS).assertEquals(t)}lt(e){return this.lte(e).and(this.value.equals(e.value).not())}assertLt(e){this.lt(e).assertEquals(!0)}gt(e){return e.lt(this)}assertGt(e){e.assertLt(this)}};c.NUM_BITS=32;(0,F.__decorate)([_,(0,F.__metadata)("design:type",i)],c.prototype,"value",void 0);var D=class extends x{constructor(e){super();this.value=e}static check(e){let t=e.value.seal();t.mul(t).assertEquals(i.one)}static get Pos(){return new D(i.one)}static get Neg(){return new D(i.one.neg())}};(0,F.__decorate)([_,(0,F.__metadata)("design:type",i)],D.prototype,"value",void 0);var S=class{constructor(e){this.value=e}static check(){throw"todo: int64 check"}toString(){let e=this.value.toString();return BigInt(e)<1n<<64n?e:"-"+this.value.neg().toString()}static get zero(){return new S(i.zero)}static fromUnsigned(e){return new S(e.value)}static shift(){return i.fromJSON((1n<<64n).toString())}uint64Value(){return BigInt(this.value.toString())<1n<<64n?this.value:this.value.add(S.shift())}static sizeInFields(){return 1}neg(){return new S(this.value.neg())}add(e){return new S(this.value.add(e.value))}sub(e){return new S(this.value.sub(e.value))}repr(){throw"repr"}static toFields(e){return[e.value]}static ofFields(e){return new S(e[0])}toFields(){return S.toFields(this)}sizeInFields(){return S.sizeInFields()}};(0,F.__decorate)([_,(0,F.__metadata)("design:type",i)],S.prototype,"value",void 0);var le={};Q(le,{LocalBlockchain:()=>Qe,currentSlot:()=>nt,currentTransaction:()=>m,getAccount:()=>J,getBalance:()=>rt,nextTransactionId:()=>$,setActiveInstance:()=>et,transaction:()=>tt});var Re=d,Ue=d,We=d,Ye=c,Ze=S,we=8,Se=class{constructor(e,t,r,s,o){this.initialMinimumBalance=e,this.cliffTime=t,this.cliffAmount=r,this.vestingPeriod=s,this.vestingIncrement=o}},ne=class{constructor(e,t){this.set=e,this.value=t}setValue(e){this.set=new h(!0),this.value=e}},g=class{constructor(e,t,r){this.constant=e,this.signatureNecessary=t,this.signatureSufficient=r}static impossible(){return new g(new h(!0),new h(!0),new h(!1))}static none(){return new g(new h(!0),new h(!1),new h(!0))}static proof(){return new g(new h(!1),new h(!1),new h(!1))}static signature(){return new g(new h(!1),new h(!0),new h(!0))}static proofOrSignature(){return new g(new h(!1),new h(!1),new h(!0))}static proofAndSignature(){return new g(new h(!1),new h(!0),new h(!1))}},j=class{constructor(e,t,r,s,o,a,l,p,f,u){this.stake=e,this.editState=t,this.send=r,this.receive=s,this.setDelegate=o,this.setPermissions=a,this.setVerificationKey=l,this.setSnappUri=p,this.editRollupState=f,this.setTokenSymbol=u}static default(){return new j(new h(!0),g.proof(),g.signature(),g.proof(),g.signature(),g.signature(),g.signature(),g.signature(),g.proof(),g.signature())}};var re=class{constructor(e,t,r,s,o,a,l){this.appState=e,this.delegate=t,this.verificationKey=r,this.permissions=s,this.snappUri=o,this.tokenSymbol=a,this.timing=l}},be=()=>new d(i.one),xe=class{constructor(e,t){this.hash=e,this.events=t}},ve=class{constructor(){}},M=class{constructor(e,t,r,s,o,a,l,p){this.publicKey=e,this.update=t,this.tokenId=r,this.delta=s,this.events=o,this.sequenceEvents=a,this.callData=l,this.depth=p}static keepAll(e){function t(o){return new ne(new h(!1),o)}let r=[];for(let o=0;o<we;++o)r.push(t(i.zero));let s=new re(r,t(new N(C.generator)),t({hash:i.zero,value:void 0}),t(j.default()),t(void 0),t(void 0),t(void 0));return new M(e,s,be(),S.zero,new xe(i.zero,[]),i.zero,new ve,i.zero)}},se=class{constructor(e,t){this.check=e,this.value=t}},Y=class{constructor(e,t){this.lower_=e,this.upper_=t}assertBetween(e,t){this.lower=e,this.upper=t}set lower(e){this.lower_=e}get lower(){if(this.lower_===void 0)throw new Error("Cannot get lower before it was set.");return this.lower_}set upper(e){this.upper_=e}get upper(){if(this.upper_===void 0)throw new Error("Cannot get upper before it was set.");return this.upper_}},oe=class{constructor(e,t){this.hash_=e,this.totalCurrency=t}},ie=class{constructor(e,t,r,s,o){this.ledger=e,this.seed_=t,this.startCheckpoint_=r,this.lockCheckpoint_=s,this.epochLength=o}get seed(){if(this.seed_.value===null)throw new Error("Cannot get seed before it was set.");return this.seed_.value}get startCheckpoint(){if(this.startCheckpoint_.value===null)throw new Error("Cannot get startCheckpoint before it was set.");return this.startCheckpoint_.value}get lockCheckpoint(){if(this.lockCheckpoint_.value===null)throw new Error("Cannot get lockCheckpoint before it was set.");return this.lockCheckpoint_.value}},H=class{constructor(e,t,r,s,o,a,l,p,f,u,w){this.snarkedLedgerHash_=e,this.snarkedNextAvailableToken=t,this.timestamp=r,this.blockchainLength=s,this.minWindowDensity=o,this.lastVrfOutput_=a,this.totalCurrency=l,this.globalSlotSinceHardFork=p,this.globalSlotSinceGenesis=f,this.stakingEpochData=u,this.nextEpochData=w}static ignoreAll(){let e=new oe(v(i.zero),G()),t=new ie(e,v(i.zero),v(i.zero),v(i.zero),L());return new H(v(i.zero),G(),G(),L(),L(),v(i.zero),G(),L(),L(),t,t)}get snarkedLedgerHash(){if(this.snarkedLedgerHash_.check=new h(!0),this.snarkedLedgerHash_.value===null)throw new Error("Cannot get snarkedLedgerHash before it was set.");return this.snarkedLedgerHash_.value}get lastVrfOutput(){if(this.lastVrfOutput_.check=new h(!0),this.lastVrfOutput_.value===null)throw new Error("Cannot get lastVrfOutput before it was set.");return this.lastVrfOutput_.value}};function v(n){return new se(new h(!1),n)}var L=()=>new Y(c.fromNumber(0),c.MAXINT()),G=()=>new Y(d.fromNumber(0),d.MAXINT()),K=class{constructor(e,t,r,s,o,a,l,p){this.balance=e,this.nonce=t,this.receiptChainHash=r,this.publicKey=s,this.delegate=o,this.state=a,this.sequenceState=l,this.provedState=p}static ignoreAll(){let e=[];for(let t=0;t<we;++t)e.push(v(i.zero));return new K(G(),L(),v(i.zero),v(new N(C.generator)),v(new N(C.generator)),e,v(i.zero),v(new h(!1)))}},ae=class{constructor(e){this.body=e}addInPlace(e){this.body.delta=this.body.delta.add(e)}subInPlace(e){this.body.delta=this.body.delta.sub(e)}},A=class{constructor(e,t){this.body=e,this.predicate=t}get balance(){return new ae(this.body)}get update(){return this.body.update}get publicKey(){return this.body.publicKey}static createUnsigned(e){let t=e,r=M.keepAll(t);if(m===void 0)throw new Error("Party.createUnsigned: Cannot run outside of a transaction");let s=new A(r,void 0);return m.nextPartyIndex++,m.parties.push(s),s}static createSigned(e){let t=e.toPublicKey(),r=M.keepAll(t);return J(t).then(s=>{if(m===void 0)throw new Error("Party.createSigned: Cannot run outside of a transaction");if(s==null)throw new Error("Party.createSigned: Account not found");let o=new A(r,s.nonce);return m.nextPartyIndex++,m.parties.push(o),o})}};var $={value:0},m,Qe=()=>{let n=3*60*1e3,e=new Date().valueOf(),t=te.create([]),r=()=>c.fromNumber(Math.ceil((new Date().valueOf()-e)/n)),s=(u,w)=>{t.addAccount(u,w)},o=[];for(let u=0;u<10;++u){let w=3e10,I=B.random(),z=I.toPublicKey();s(z,w),o.push({privateKey:I,publicKey:z})}let a=u=>{let w=t.getAccount(u);if(w==null)throw new Error(`getAccount: Could not find account for ${JSON.stringify(u.toJSON())}`);{let I={balance:new d(w.balance.value),nonce:new c(w.nonce.value),snapp:w.snapp};return new Promise(z=>z(I))}};function l(u){return{ledger:{hash:u.ledger.hash_,totalCurrency:u.ledger.totalCurrency},seed:u.seed_,startCheckpoint:u.startCheckpoint_,lockCheckpoint:u.lockCheckpoint_,epochLength:u.epochLength}}let p=u=>({publicKey:u.publicKey,update:u.update,tokenId:u.tokenId,delta:u.delta,events:[],sequenceEvents:[],callData:i.zero,depth:0});return{currentSlot:r,getAccount:a,transaction:(u,w)=>{if(m!==void 0)throw new Error("Cannot start new transaction within another transaction");m={sender:u,parties:[],nextPartyIndex:0,protocolState:H.ignoreAll()};let I=y.runAndCheck(()=>{let q=w();return q instanceof Promise?q.then(()=>()=>{}):new Promise(Z=>Z(()=>{}))}).catch(q=>{throw m=void 0,q}),z=u.toPublicKey(),Ce=I.then(()=>a(z)).then(q=>{if(m===void 0)throw new Error("Transaction is undefined");let R=m.parties.map(V=>{let U;return V.predicate instanceof c?U={type:"nonce",value:V.predicate}:V.predicate===void 0?U={type:"accept"}:U={type:"full",value:V.predicate},{body:p(V.body),predicate:U}}),Z={body:p(M.keepAll(z)),predicate:q.nonce},k=m.protocolState,Ee={protocolState:{snarkedLedgerHash:k.snarkedLedgerHash_,snarkedNextAvailableToken:k.snarkedNextAvailableToken,timestamp:k.timestamp,blockchainLength:k.blockchainLength,minWindowDensity:k.minWindowDensity,lastVrfOutput:k.lastVrfOutput_,totalCurrency:k.totalCurrency,globalSlotSinceGenesis:k.globalSlotSinceGenesis,globalSlotSinceHardFork:k.globalSlotSinceHardFork,nextEpochData:l(k.nextEpochData),stakingEpochData:l(k.stakingEpochData)},otherParties:R,feePayer:Z};return $.value+=1,m=void 0,Ee});return{send:()=>{let q=Ce.then(R=>t.applyPartiesTransaction(R));return{wait:()=>q}}}},addAccount:s,testAccounts:o}},X={currentSlot:()=>{throw new Error("must call Mina.setActiveInstance first")},getAccount:()=>{throw new Error("must call Mina.setActiveInstance first")},transaction:()=>{throw new Error("must call Mina.setActiveInstance first")}};function et(n){X=n}function tt(n,e){return X.transaction(n,e)}function nt(){return X.currentSlot()}function J(n){return X.getAccount(n)}function rt(n){return X.getAccount(n).then(e=>e.balance)}function st(){return ot()}function ot(){return{_initialized:!1,_key:void 0,_ty:void 0,_this:void 0,_SnappClass:void 0,_init(n,e,t,r){this._initialized=!0,this._key=n,this._ty=e,this._this=t,this._SnappClass=r},getLayout(){let e=this._SnappClass._layout().get(this._key);if(e===void 0)throw new Error(`state ${this._key} not found`);return e},set(n){if(!this._initialized)throw Error("set can only be called when the State is assigned to a SmartContract @state.");let e=this.getLayout(),t=this._ty.toFields(n),r=this._this.executionState();t.forEach((s,o)=>{r.party.body.update.appState[e.offset+o].setValue(s)})},assertEquals(n){if(!this._initialized)throw Error("assertEquals can only be called when the State is assigned to a SmartContract @state.");let e=this.getLayout(),t=this._ty.toFields(n),r=this._this.executionState();t.forEach((s,o)=>{r.party.predicate.state[e.offset+o].check=new h(!0),r.party.predicate.state[e.offset+o].value=s})},async get(){if(!this._initialized)throw Error("get can only be called when the State is assigned to a SmartContract @state.");let n=this.getLayout(),e=this._this.address,t;if(y.inProver())t=J(e).then(o=>{let a=[];for(let l=0;l<n.length;++l)a.push(o.snapp.appState[n.offset+l]);return y.witness(y.array(i,n.length),()=>a)});else{let o=y.witness(y.array(i,n.length),()=>{throw Error("this should never happen")});t=new Promise(a=>a(o))}let r=await t,s=this._ty.ofFields(r);return this._ty.check!=null&&this._ty.check(s),s}}}function it(n){return function(e,t,r){let s=e.constructor;if(!(s.prototype instanceof ue))throw new Error("Can only use @state decorator on classes that extend SmartContract");if(t==="_states"||t==="_layout")throw new Error("Property names _states and _layout reserved.");if(s._states==null){s._states=[];let o;s._layout=()=>{if(o===void 0){o=new Map;let a=0;s._states.forEach(([l,p])=>{let f=p.sizeInFields();o.set(l,{offset:a,length:f}),a+=f})}return o}}s._states.push([t,n]),Object.defineProperty(e,t,{get(){return this._?.[t]},set(o){if(o._initialized)throw Error("A State should only be assigned once to a SmartContract");if(this._?.[t])throw Error("A @state should only be assigned once");o._init(t,n,this,s),(this._??(this._={}))[t]=o}})}}function at(n,e,t){}var ue=class{constructor(e){this.address=e}deploy(...e){try{this.executionState().party.body.update.verificationKey.set=h(!0)}catch{throw new Error("Cannot deploy SmartContract outside a transaction.")}}executionState(){if(m===void 0)throw new Error("Cannot execute outside of a Mina.transaction() block.");if(this._executionState!==void 0&&this._executionState.transactionId===$.value)return this._executionState;{let e=$.value,t=m.nextPartyIndex++,r=M.keepAll(this.address),s=K.ignoreAll(),o=new A(r,s);m.parties.push(o);let a={transactionId:e,partyIndex:t,party:o,protocolStatePredicate:m.protocolState};return this._executionState=a,a}}get protocolState(){return this.executionState().protocolStatePredicate}get self(){return this.executionState().party}get balance(){return this.self.balance}get nonce(){let e;if(y.inProver())e=J(this.address).then(t=>y.witness(c,()=>t.nonce));else{let t=y.witness(c,()=>{throw Error("this should never happen")});e=new Promise(r=>r(t))}return e.then(t=>(this.executionState().party.predicate.nonce.assertBetween(t,t),t))}party(e){throw"party"}transactionHash(){throw"txn hash"}emitEvent(e){P.hash(e.toFields())}};var ke=class{constructor(e,t){this.isSome=e,this.value=t}};function lt(n){}function ut(n,e,t){}var _e=class{constructor(e){this.publicInput=e,this.proof=null}assertVerifies(){}};0&&(module.exports={AccountPredicate,Amount,Balance,Body,Bool,Circuit,CircuitValue,ClosedInterval,EpochDataPredicate,EpochLedgerPredicate,Fee,Field,GlobalSlot,Group,Int64,Ledger,Mina,Optional,OrIgnore,Party,PartyBalance,Perm,Permissions,Poseidon,PrivateKey,ProofWithInput,ProtocolStatePredicate,PublicKey,Scalar,SetOrKeep,Signature,SignedAmount,SmartContract,State,Timing,UInt32,UInt64,Update,arrayProp,asFieldElementsToConstant,branch,circuitMain,getDefaultTokenId,isReady,matrixProp,method,proofSystem,prop,public_,shutdown,state});
